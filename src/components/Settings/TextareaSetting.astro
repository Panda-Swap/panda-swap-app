---
import { DEFAULT_SETTINGS } from '../../store/settings-store';
import type { Settings } from '../../types/settings';

interface Props {
  label: string;
  name: string;
  group: keyof Settings;
  value: string;
}

const { label, name, group, value } = Astro.props;
---

<div class="block space-y-2" data-default-value={DEFAULT_SETTINGS[group][name as keyof Settings[typeof group]]}>
  <div class="flex items-center justify-between">
    <span data-i18n={`settings.${group}.${name}`}>{label}</span>
    <button
      type="button"
      class="ml-2 p-1 text-gray-600 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400"
      data-reset-textarea
      title="Reset to default"
    >
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 512 512">
        <path fill="currentColor" d="M48.5 224H40c-13.3 0-24-10.7-24-24V72c0-9.7 5.8-18.5 14.8-22.2s19.3-1.7 26.2 5.2L98.6 96.6c87.6-86.5 228.7-86.2 315.8 1c87.5 87.5 87.5 229.3 0 316.8s-229.3 87.5-316.8 0c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0c62.5 62.5 163.8 62.5 226.3 0s62.5-163.8 0-226.3c-62.2-62.2-162.7-62.5-225.3-1L185 183c6.9 6.9 8.9 17.2 5.2 26.2s-12.5 14.8-22.2 14.8H48.5z"/>
      </svg>
    </button>
  </div>
  <textarea
    class="block w-full rounded-md bg-gray-200 border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white"
    name={name}
    data-settings-group={group}
  >{value}</textarea>
</div>

<script>
  function initResetButtons() {
    document.querySelectorAll('[data-reset-textarea]').forEach((button) => {
      button.addEventListener('click', (e) => {
        const container = button.closest('div[data-default-value]');
        const textarea = container?.querySelector('textarea');
        const defaultValue = container?.getAttribute('data-default-value');
        
        if (textarea && defaultValue) {
          textarea.value = defaultValue;
          const event = new Event('change', { bubbles: true });
          textarea.dispatchEvent(event);
        }
      });
    });
  }

  initResetButtons();
  document.addEventListener('astro:page-load', initResetButtons);
</script>