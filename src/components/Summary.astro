---
import Card from '../components/Card.astro'
import GCodeFileMetatdata from '../components/GCodeFileMetadata.astro'

interface Props {
    files: Array<{
      id: string;
      name: string;
      quantity: number;
      metadata: {
        plateName: string;
        colors: Array<{ color: string; weight: number }>;
        totalTime: number;
        modelImage?: string;
      };
    }>;
  }
  
  const { files } = Astro.props;
  
  // Calculate total filament usage by color
  const totalFilamentByColor = files.reduce((acc, file) => {
    file.metadata.colors.forEach(({ color, weight }) => {
      acc[color] = (acc[color] || 0) + weight * file.quantity;
    });
    return acc;
  }, {} as Record<string, number>);
  ---
  
  <Card title="Print Summary" className="mb-8">
    <!-- Previous template code remains the same -->
  </Card>
  
  <div id="file-list" class="space-y-4">
    <!-- Previous template code remains the same -->
  </div>
  
  <button
    id="merge-files"
    class="w-full mt-6 px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white font-medium rounded-lg transition-colors"
    disabled={files.length === 0}
  >
    Merge and Download Files
  </button>
  
  <script>
    // Import Sortable as a module
    const Sortable = await import('sortablejs').then(m => m.default);
    
    const fileList = document.getElementById('file-list');
    if (fileList) {
      new Sortable(fileList, {
        handle: '[data-drag-handle]',
        animation: 150,
        onEnd: (evt) => {
          const event = new CustomEvent('fileOrderChanged', {
            detail: { oldIndex: evt.oldIndex, newIndex: evt.newIndex }
          });
          window.dispatchEvent(event);
        }
      });
    }
  
    // Rest of the script remains the same
  </script>