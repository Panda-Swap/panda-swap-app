---
import { getCurrentLanguage, useTranslations } from '../i18n/utils';

interface Props {
  title: string;
  description?: string;
  lang?: string;
}

const { t } = useTranslations(getCurrentLanguage());
const {
  title,
  description = t('app.description'),
  lang = getCurrentLanguage()
} = Astro.props;

// Ensure proper title format
const pageTitle = title.includes(t('app.title')) ? title : `${title} | ${t('app.title')}`;
---

<!doctype html>
<html lang={lang} class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    
    <!-- Primary Meta Tags -->
    <title>{pageTitle}</title>
    <meta name="title" content={pageTitle} />
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    
    <!-- Add these script tags to your HTML head -->
    <script src="https://cdn.jsdelivr.net/npm/@nanostores/persistent@0.9.1/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/nanostores@0.9.5/index.js"></script>

    <!-- If you need specific file formats support -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three-gcode-loader@1.0.0/GCodeLoader.js"></script>

    <!-- For sortable functionality -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>
    
    <!-- Theme Script -->
    <script is:inline>
      // Handle theme initialization
      const theme = (() => {
        if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
          return localStorage.getItem('theme');
        }
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
          return 'dark';
        }
        return 'light';
      })();
      
      if (theme === 'dark') {
        document.documentElement.classList.add('dark');
      }
    </script>
  </head>
  <body class="h-full bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white antialiased">
    <slot />
  </body>
</html>

<style is:global>
  :root {
    color-scheme: light dark;
  }

  html {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
      Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    -webkit-text-size-adjust: 100%;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
  }

  body {
    min-height: 100vh;
    margin: 0;
    padding: 0;
  }

  ::selection {
    @apply bg-blue-500/20;
  }

  /* Scrollbar styles */
  ::-webkit-scrollbar {
    width: 0.5rem;
    height: 0.5rem;
  }

  ::-webkit-scrollbar-track {
    @apply bg-transparent;
  }

  ::-webkit-scrollbar-thumb {
    @apply bg-gray-300 dark:bg-gray-700 rounded-full;
  }

  ::-webkit-scrollbar-thumb:hover {
    @apply bg-gray-400 dark:bg-gray-600;
  }

  /* Focus styles */
  :focus-visible {
    @apply outline-none ring-2 ring-blue-500 ring-offset-2 ring-offset-white dark:ring-offset-gray-900;
  }
</style>